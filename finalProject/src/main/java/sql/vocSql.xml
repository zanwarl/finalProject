<!-- <?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="korea.voc">


	insert
	<insert id="vocWriteSql" parameterType="korea.voc.model.VocDTO">
		insert into voc values (
		vocIdx.nextval, 
		#{writer},
		#{title},
		#{content},
		sysdate, 
		#{ref},
		0,
		0
		}
		

	</insert>


	
	<select id="getMyVocTotalCntSql" parameterType="String" resultType="int" >
		select count (*) from voc where ref in (
		select ref from voc where writer = #{writer}
		)
	
	</select>
	
	<select id="getVocTotalCntSql" resultType="int">
		select count (*) from voc 
	</select>
	
	
	 <select id="getNoAnsVocTotalCntSql" resultType="int">
		select count (*)
		 from voc 
		 where ref not in (select ref from voc where lev != 0 ) 
	</select> 


	<select id="myVocListSql" resultType="korea.voc.model.VocDTO" parameterType="map">
	  
	  
	    <![CDATA[ 
  select * from (
  select rownum rnum,a.* from (
  select * from voc where ref in (
  select ref from voc where writer = #{writer} )order by ref desc , turn asc ) a)b 
  where rnum>=#{startNum} and rnum<=#{endNum} 
   ]]>
	  
		
	</select>
	
	<update id="vocUpdateSql" parameterType="map" >
		update voc set title =#{title}, content = #{content} where idx = #{idx}
	
	
	</update>
	
	<delete id="vodDelSql" parameterMap="int">
		delete from voc where idx = #{idx}
	</delete>
	
	<insert id="vocReWriteSql" parameterMap="korea.voc.model.VocDTO">
	insert into voc values (
		vocIdx.nextval, 
		#{writer},
		#{title},
		#{content},
		sysdate, 
		#{ref}, 
		#{lev},
		#{turn}
		
		}
	
	</insert>
	
	<select id="vocConSql" resultType="korea.voc.model.VocDTO" parameterType="int">
		select * from voc where idx = #{idx}
	
	</select>
	
	
	 get max ref
	<select id="getVocMaxRefSql">
	select max (ref) from voc 
	
	</select>
	
	list
	<select id="vocListSql" resultType="korea.voc.model.VocDTO" parameterType="map">
		    <![CDATA[ 
  select * from (
  select rownum rnum,a.* from (
  select * from voc voc order by ref desc , turn asc a)b 
  where rnum>=#{startNum} and rnum<=#{endNum} 
   ]]>
	  
	</select>
	
	<select id="vocNoAnsListSql" resultType="korea.voc.model.VocDTO" parameterType="map">
	    <![CDATA[ 
  select * from (
  select rownum rnum,a.* from (
  select * from voc_tb where ref not in (select ref from voc_tb where lev != 0 )
  
   order by ref desc , turn asc a)b 
  where rnum>=#{startNum} and rnum<=#{endNum} 
   ]]>
	</select>
	
	<update id="vocTurnUpdateSql" parameterType="map">
	update voc set turn=turn+1 where ref=#{ref} and turn>=#{turn}";
	        
	</update>
	

	
	
</mapper> -->